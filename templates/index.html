{% extends "base.html" %}
{% block title %}–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞{% endblock %}

{% block left %}
<h5 class="mb-3">üìã –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h5>
<div class="row">
    <div class="col-md-12">
        <form action="/start" method="get">
            <button type="submit" class="btn btn-primary w-100">‚ñ∂Ô∏è Start</button>
        </form>
    </div>

    <div class="col-md-5 d-flex align-items-center py-1">
        <span class="badge bg-success">–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: {{ sent or 0 }}</span>
        <span class="badge bg-warning text-dark">–û–∂–∏–¥–∞–µ—Ç: {{ pending or 0 }}</span>
        <span class="badge bg-danger">–û—à–∏–±–æ–∫: {{ error or 0 }}</span>
    </div>

    <div class="col-md-7 d-flex align-items-center py-1 ps-3">
        {% if message %}
        <p class="text-info m-0 small" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
            {{ message }}
        </p>
        {% endif %}
        {% if error %}
        <p class="text-danger m-0 small">–û—à–∏–±–∫–∞: {{ error }}</p>
        {% endif %}
    </div>
</div>

<div class="row">
    <div class="col-md-5">
        <div class="row mt-4">
            <div class="col-md-12 border p-1 ratio ratio-4x3">
                {% if image_directory_path %}
                <img src="{{ image_directory_path }}" class="img-fluid object-fit-contain" alt="–ö–∞—Ä—Ç–∏–Ω–∫–∞">
                {% else %}
                <div class="d-flex justify-content-center align-items-center h-100">
                    <p class="m-0 text-muted">–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="col-md-7">
        <div class="row">
            <form action="/reset_statuses" method="get" class="mb-1">
                <button type="submit" class="btn btn-danger w-100">üîÑ –°–±—Ä–æ—Å–∏—Ç—å —Å—Ç–∞—Ç—É—Å—ã</button>
            </form>
        </div>
        <div>
            <form action="/create_profile" method="post">
                <label for="profile_name" class="form-label">–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å:</label>
                <div class="input-group">
                    <input type="text" name="profile_name" id="profile_name" class="form-control" placeholder="–ò–º—è –ø—Ä–æ—Ñ–∏–ª—è"
                        required></label>
                    <button type="submit" class="btn btn-success">–î–æ–±–∞–≤–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </div>
</div>
<script>
    document.getElementById('fileInput').addEventListener('change', function () {
        if (this.files.length > 0) {
            document.getElementById('textForm').submit();
        }
    });
</script>

{% endblock %}

{% block right %}
<h5 class="mb-3">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h5>
<div class="col-md-12 d-flex align-items-center">
    <div class="col-md-6">
        <form id="imageForm" action="/upload_image" method="POST" enctype="multipart/form-data" class="mb-2">
            <input type="file" name="file" accept=".jpg" class="d-none" id="imageInput">
            <label for="imageInput" class="btn btn-success w-100">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</label>
        </form>
    </div>
    <div class="col-md-6">
        <form id="textForm" action="/upload_contacts" method="POST" enctype="multipart/form-data" class="mb-2 ms-1">
            <input type="file" name="file" accept=".txt, .json" class="d-none" id="fileInput">
            <label for="fileInput" class="btn btn-success w-100">–ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–º–µ—Ä–∞</label>
        </form>
    </div>
</div>
<form action="/add_number" method="post">
    <label for="phone" class="form-label">üìû –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞:</label>
    <div class="input-group">
        <span class="input-group-text">+7</span>
        <input type="tel" name="phone" id="phone" class="form-control" placeholder="7011234567" required></label>
        <button type="submit" class="btn btn-success">–î–æ–±–∞–≤–∏—Ç—å</button>
    </div>
</form>

<form action="{{ url_for('set_category') }}" method="post" id="categoryForm">
    <label for="categorySelect" class="form-label">üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
    <select name="category" id="categorySelect" class="form-select" required
        onchange="document.getElementById('categoryForm').submit()">
        <option value="" selected hidden>-- –í—ã–±–µ—Ä–∏—Ç–µ --</option>
        {% for cat in categories %}
        <option value="{{ cat }}" {% if cat==selected_category %}selected{% endif %}>{{ cat }}</option>
        {% endfor %}
    </select>
</form>
<div class="mt-2">
    <span class="badge bg-info">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: {{ g.length }}</span>
</div>
<form action="/delete_category" method="post" id="deleteCategoryForm">
    <button type="submit" class="btn btn-danger w-100">üóë –£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>
</form>

{% endblock %}

{% block picture %}
<div class="mb-4">
    <form action="/text" method="post" enctype="multipart/form-data" class="mb-2" id="textForm">
        <label for="text" class="form-label">üí¨ –í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ</label>
        <div class="mb-2">
            <textarea name="text" id="text" class="form-control textarea_message" maxlength="1000"
                placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç...">{{ session.get('text_message') }}</textarea>
        </div>
        <div class="d-flex gap-2">
            <button type="submit" name="action" value="prev" class="btn btn-outline-primary">–ü—Ä–µ–¥—ã–¥—É—â–µ–µ</button>
            <button type="submit" name="action" value="next" class="btn btn-outline-primary">–°–ª–µ–¥—É—é—â–µ–µ</button>
            <button type="submit" name="action" value="save" class="btn btn-outline-success">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            <button type="submit" name="action" value="delete" class="btn btn-outline-danger">–£–¥–∞–ª–∏—Ç—å</button>
            <input type="file" name="file" accept=".txt" class="d-none" id="fileInput">
            <label for="fileInput" class="btn btn-outline-success" style="cursor: pointer;">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç–µ–∫—Å—Ç</label>
        </div>
        <div class="mt-2">
            <span class="badge bg-info">–°–æ–æ–±—â–µ–Ω–∏–µ:
                {{ position_message + 1}} –∏–∑ {{ length_messages}}
            </span>
        </div>
    </form>
</div>
{% endblock %}

{% block phone %}
{% if g.processed_numbers %}
<h6 class="mt-2">üì± –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –Ω–æ–º–µ—Ä–∞:</h6>
<ol class="list-group list-group-numbered scrollable-list flex-grow-1">
    {% for contact in g.processed_numbers %}
    <li class="list-group-item small d-flex align-items-center justify-content-between">
        <div>
            {% if contact.status == "sent" %}
            ‚úÖ
            {% elif contact.status == "pending" %}
            ‚è≥
            {% elif contact.status == "error" %}
            ‚ùå
            {% else %}
            ‚ùî
            {% endif %}
            {{ contact.name or "–ë–µ–∑ –∏–º–µ–Ω–∏" }} ‚Äî {{ contact.number }}
        </div>
        <div class="btn-group btn-group-sm" role="group">
            <form action="/change_status" method="post" class="d-inline">
                <input type="hidden" name="phone" value="{{ contact.number }}">
                <input type="hidden" name="status" value="sent">
                <button type="submit" class="btn btn-success" title="–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ">‚úÖ</button>
            </form>
            <form action="/change_status" method="post" class="d-inline">
                <input type="hidden" name="phone" value="{{ contact.number }}">
                <input type="hidden" name="status" value="pending">
                <button type="submit" class="btn btn-warning" title="–û–∂–∏–¥–∞–µ—Ç">‚è≥</button>
            </form>
            <form action="/delete_number" method="post" class="d-inline">
                <input type="hidden" name="phone" value="{{ contact.number }}">
                <button type="submit" class="btn btn-outline-danger" title="–£–¥–∞–ª–∏—Ç—å">üóë</button>
            </form>
        </div>
    </li>
    {% endfor %}
</ol>
{% endif %}
{% endblock %}